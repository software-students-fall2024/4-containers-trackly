<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Start Focusing</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f4f4f9;
        }
        h1 {
            color: #333;
            font-size: 3rem;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Start Focusing</h1>
    <ul>
        {% for task in tasks %}
            <li><strong>{{ task.name }}:</strong> {{ task.task }}:</strong> {{ task.time }}:</li>
        {% else %}
            <li>No tasks available.</li>
        {% endfor %}
    </ul>
    <h2>Live Stream</h2>
    <!-- Add your focus tracking functionality here -->
     <!-- Trying to add webcam -->
      <video id="video" width = "480" height = "360" autoplay></video> <br>
      <button id = "startRecord">Start Recording</button>
      <button id = "stopRecord">Stop Recording</button>
      <a id="downloadingLink" download = "video.mp4">Download Video</a>

      <script type="text/javascript">
        var video = document.querySelector("#video");
        var startRecord = document.querySelector("#startRecord");
        var stopRecord = document.querySelector("#stopRecord");
        var downloadLink = document.querySelector("#downloadingLink");
    
        let mediaRecorder;
        let videoStream;
    
        window.onload = async function () {
            stopRecord.style.display = "none";
    
            // Request user media
            videoStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
            video.srcObject = videoStream;
        };
    
        startRecord.onclick = function () {
            startRecord.style.display = "none";
            stopRecord.style.display = "inline";
    
            // Initialize MediaRecorder
            mediaRecorder = new MediaRecorder(videoStream);
            let blob = [];
            mediaRecorder.addEventListener("dataavailable", function (e) {
                blob.push(e.data);
            });
            mediaRecorder.addEventListener("stop", async function() {
                const blobFile = new Blob(blob, { type: "video/webm" });
                const formData = new FormData();
                formData.append("file", blobFile, "recorded-video.webm");
                // sending file to the server
                await fetch("http://localhost:5001/file-data", { method: "POST", body: formData })
                    .then(response => response.json())
                    .then(data => console.log(data))
                    .catch(error => console.error("Error uploading file:", error));

            });
    
            mediaRecorder.start();
        };
    
        stopRecord.onclick = function () {
            mediaRecorder.stop();
            startRecord.style.display = "inline";
            stopRecord.style.display = "none";
        };

    </script>
</body>
</html>
